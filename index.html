<!-- /public/index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mi Amor Eterno ‚Äì Para el amor de mi vida</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Una carta y galer√≠a dedicada a mi esposa: amor, gratitud y promesas para siempre." />
  <meta name="theme-color" content="#d6336c" />
  <style>
    :root{
      --bg:#fff7fb; --bg-soft:#fff0f5; --text:#3b2726;
      --primary:#d6336c; --accent:#6c2c38; --card:#ffffff;
      --shadow:0 8px 20px rgba(0,0,0,.12); --radius:16px; --maxw:960px;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#1a171a; --bg-soft:#221c22; --text:#f7eef4; --primary:#ff5a8f; --accent:#f2b7c7; --card:#272127; --shadow:0 8px 20px rgba(0,0,0,.35); }
    }
    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0; font-family: ui-serif, Georgia, "Times New Roman", serif;
      line-height:1.8; font-size:18px; color:var(--text);
      background:
        linear-gradient(to right, rgba(255,220,240,.72), rgba(235,200,255,.82)),
        url("img/baground.png");
      background-attachment:fixed; background-size:cover; background-position:center; background-blend-mode:overlay;
      text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    @media (prefers-reduced-motion: reduce){ html{scroll-behavior:auto;} *{animation:none!important; transition:none!important;} }

    .skip-link{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skip-link:focus{ position:fixed; left:12px; top:12px; padding:.6rem .9rem; background:var(--primary); color:#fff; border-radius:12px; z-index:999; box-shadow:var(--shadow); }

    header{
      padding: clamp(40px, 6vw, 72px) 20px; text-align:center;
      background: color-mix(in oklab, var(--bg-soft) 90%, transparent);
      box-shadow: 0 4px 10px rgba(0,0,0,.06); backdrop-filter: blur(3px);
    }
    header h1{
      margin:0 0 .4rem; font-size:clamp(2rem,4.5vw,3rem); color:var(--primary); letter-spacing:.4px;
      text-wrap: balance;
    }
    header p{ margin:0; font-size:clamp(1rem,2.5vw,1.2rem); color:var(--accent); }

    main{ padding:32px 20px; }
    .container{ max-width:var(--maxw); margin-inline:auto; }

    .photo{ text-align:center; margin:24px auto 32px; }
    .photo figure{ margin:0; }
    .photo img{
      width: 280px; max-width:88vw; height:auto;
      border-radius:20px; box-shadow:0 12px 25px rgba(0,0,0,.16);
      aspect-ratio: 7 / 9; object-fit: cover;
    }
    .tagline{
      margin-top:.65rem; font-size:1.1rem; font-weight:700;
      color:var(--primary); letter-spacing:.3px; text-wrap: balance;
    }

    .message-block{
      background: color-mix(in oklab, var(--card) 92%, transparent);
      border-radius:var(--radius); padding:clamp(18px,3vw,28px); margin:0 auto 22px;
      box-shadow:var(--shadow); animation:fadeIn .6s ease both;
    }
    .message-block h2{
      color:var(--primary); margin:0 0 .35rem;
      font-size: clamp(1.25rem, 3.2vw, 1.6rem);
      text-wrap: balance;
    }
    .message-block p{ margin:.5rem 0; font-size:1.06rem; letter-spacing:.2px; }

    /* ===== Galer√≠a ===== */
    .gallery{ display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:16px; }
    .gallery img{
      width:100%; height:auto; display:block;
      border-radius:12px; box-shadow:var(--shadow);
      aspect-ratio: 4 / 5; object-fit: cover;
      background:#f2f2f2; cursor: zoom-in;
      user-select:none;
    }

    /* Dedicaci√≥n */
    .dedication{
      margin:24px auto 0; max-width:var(--maxw);
      background: color-mix(in oklab, var(--bg-soft) 85%, transparent);
      border:1px solid rgba(0,0,0,.06); box-shadow: var(--shadow);
      border-radius: 20px; padding: 16px 18px;
      display:flex; justify-content:center; align-items:center; gap:.5rem;
      font-weight:700; font-size: clamp(1.05rem, 2vw, 1.2rem);
      color: var(--accent); text-align:center;
    }
    .dedication .heart{ display:inline-block; }
    @keyframes beat{ 0%,100%{ transform:scale(1);} 50%{ transform:scale(1.12);} }
    @media (prefers-reduced-motion: no-preference){
      .dedication .heart{ animation: beat 1.4s ease-in-out infinite; transform-origin:center; }
    }

    footer{ text-align:center; padding:22px 16px; background:#ffe3ec10; color:var(--text); }

    @keyframes fadeIn{ from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

    a{ color:var(--primary); }
    strong{ color:var(--primary); }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    /* M√∫sica */
    .music-ctrl{
      position: fixed; right:16px; bottom:16px; z-index:1000;
      display:flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:999px; border:1px solid rgba(0,0,0,.08);
      background: var(--card); box-shadow: var(--shadow);
    }
    .music-ctrl button{ border:none; cursor:pointer; border-radius:999px; padding:8px 12px; font-weight:600; }
    .music-ctrl .play{ background:var(--primary); color:#fff; }
    .music-ctrl .mute{ background:transparent; color:var(--accent); }
    .music-ctrl[hidden]{ display:none; }

    #yt-player{ position:fixed; width:1px; height:1px; left:-9999px; top:-9999px; }
    #bgmFallback{ display:none; }

    /* Lightbox minimal */
    .lightbox{ position:fixed; inset:0; background: rgba(0,0,0,.86); display:none; align-items:center; justify-content:center; z-index:1100; }
    .lightbox.open{ display:flex; }
    .lightbox img{ max-width:90vw; max-height:86vh; border-radius:16px; box-shadow:0 12px 30px rgba(0,0,0,.5); object-fit:contain; cursor: zoom-out; user-select:none; }
    .lightbox .nav{ position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; pointer-events:none; }
    .lightbox .btn{ pointer-events:auto; border:none; background: rgba(255,255,255,.12); color:#fff; padding:10px 14px; border-radius:12px; cursor:pointer; font-size:1rem; font-weight:700; backdrop-filter: blur(2px); }
    .lightbox .btn:hover{ background: rgba(255,255,255,.18); }
    .lightbox .close{ position:absolute; top:16px; right:16px; }
  </style>
</head>
<body oncontextmenu="return false">
  <a class="skip-link" href="#contenido">Saltar al contenido</a>

  <header role="banner">
    <h1>Para el Amor de Mi Vida</h1>
    <p>Una p√°gina dedicada a ti, mi reina hermosa <span aria-hidden="true">‚ù§Ô∏è</span><span class="sr-only">coraz√≥n rojo</span></p>
  </header>

  <main id="contenido" class="container" role="main">
    <section class="photo" aria-labelledby="foto-title">
      <h2 id="foto-title" class="sr-only">Foto principal</h2>
      <figure>
        <img src="img/image2.jpg" alt="Carla sonriendo en nuestro retrato favorito." width="280" height="360" decoding="async" draggable="false" />
        <figcaption class="tagline">Mi esposita, mi todo.</figcaption>
      </figure>
    </section>

    <!-- Mensajes -->
    <section class="message-block"><h2>Mi compa√±era incondicional</h2><p>Desde que llegaste a mi vida, todo cambi√≥ para mejor. Tu presencia es mi refugio, tu voz mi calma, y tu abrazo mi fortaleza. Contigo aprend√≠ que el amor verdadero no abandona, no duda, no se cansa‚Ä¶ solo crece. Gracias por caminar a mi lado en los d√≠as de sol, y a√∫n m√°s, en los de tormenta.</p></section>
    <section class="message-block"><h2>Tu sonrisa ilumina mi mundo</h2><p>No hay estrella m√°s brillante que tu sonrisa. Cuando sonr√≠es, el mundo se detiene un segundo solo para admirarte. Tu alegr√≠a no solo ilumina mi d√≠a, tambi√©n le da sentido. Eres la risa que le faltaba a mi historia.</p></section>
    <section class="message-block"><h2>Trabajadora, fuerte, √∫nica</h2><p>Eres una mujer incansable, que lucha, que sue√±a, que construye. Tu fuerza no est√° solo en tus acciones, sino en tu coraz√≥n que nunca se rinde. Eres √∫nica, irrepetible, un regalo que la vida me dio. Tu dedicaci√≥n me ense√±a cada d√≠a que el amor tambi√©n se demuestra con esfuerzo.</p></section>
    <section class="message-block"><h2>El amor que me sostiene</h2><p>T√∫ eres mi equilibrio cuando tambaleo, mi certeza cuando el mundo se vuelve incierto. Contigo, nunca estoy solo, porque hasta en silencio, me sostienes con tu amor. Eres mi fuerza silenciosa, mi raz√≥n constante, mi hogar en medio del caos.</p></section>
    <section class="message-block"><h2>Y juntos cumplimos promesas</h2><p>Promet√≠ cuidarte, y lo har√© hasta mi √∫ltimo aliento. Prometiste quedarte, y cada d√≠a cumples esa promesa con amor. Contigo, las promesas no son palabras: son abrazos, son miradas, son actos diarios de amor. Juntos escribimos una historia digna de recordarse por siempre.</p></section>
    <section class="message-block"><h2>Dios, T√∫ y Yo</h2><p>En medio de todo, Dios es nuestro centro. √âl fue quien cruz√≥ nuestros caminos, quien sembr√≥ este amor tan puro en nuestros corazones. Cada oraci√≥n compartida, cada l√°grima entregada en fe, cada sue√±o confiado a √âl‚Ä¶ han fortalecido lo que somos juntos.</p><p>Contigo aprend√≠ que el verdadero amor no se busca‚Ä¶ se ora. Y Dios, en su infinita bondad, me respondi√≥ contigo. No somos solo dos: somos <strong>Dios, T√∫ y Yo</strong>. Y con √âl en medio, nada nos faltar√°.</p></section>
    <section class="message-block"><h2>Lo que m√°s amo de ti, Carla</h2><p>Amo tu risa que llena el aire de alegr√≠a. Amo c√≥mo sonr√≠es con el alma y c√≥mo haces brillar mis d√≠as. Amo tu forma de ser feliz sin motivo, porque tu felicidad me vuelve feliz a m√≠ tambi√©n. Eres esa energ√≠a dulce, pura y luminosa que solo t√∫ puedes tener.</p></section>
    <section class="message-block"><h2>T√∫ y yo, un coraz√≥n verde y lila</h2><p>Hay cosas que solo nosotros entendemos. Como ese coraz√≥n verde üíö que nos representa, o el color lila que lleva la dulzura de nuestro amor. Son nuestros s√≠mbolos, nuestras marcas, nuestros secretos... Nuestro amor se expresa incluso en los colores.</p></section>
    <section class="message-block"><h2>Mi Carla Guadalupe Vargas Callisaya</h2><p>Tu nombre es m√∫sica para mi coraz√≥n. Carla Guadalupe, mi amada, mi compa√±era, mi destino. Te llamo ‚Äúesposita‚Äù, ‚Äúamor‚Äù, ‚Äúcoraz√≥n‚Äù, ‚Äúcari√±o‚Äù‚Ä¶ porque no hay una sola palabra que alcance para describir lo que eres para m√≠. Lo eres todo.</p></section>

    <!-- Galer√≠a -->
    <section class="message-block" aria-labelledby="galeria">
      <h2 id="galeria">Galer√≠a de Nuestro Amor üíñ</h2>
      <div id="gallery" class="gallery" aria-live="polite"></div>
    </section>
  </main>

  <!-- Dedicaci√≥n final -->
  <div class="dedication" role="note" aria-label="Dedicaci√≥n final">
    Hecho con todo mi amor <span class="heart" aria-hidden="true">üíû</span> por tu esposo que te adora.
  </div>

  <footer role="contentinfo"></footer>

  <!-- Audio: YouTube + fallback local -->
  <div id="yt-player" aria-hidden="true"></div>
  <audio id="bgmFallback" preload="auto" loop>
    <source src="audio/royalty-free.ogg" type="audio/ogg" />
    <source src="audio/royalty-free.mp3" type="audio/mpeg" />
  </audio>
  <div id="musicCtrl" class="music-ctrl" role="group" aria-label="Control de m√∫sica" hidden>
    <button id="btnPlay" class="play" aria-label="Reproducir m√∫sica">‚ñ∂Ô∏è Reproducir</button>
    <button id="btnMute" class="mute" aria-label="Silenciar/Activar sonido">üîà</button>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Visor de fotos" oncontextmenu="return false">
    <button class="btn close" id="lbClose" aria-label="Cerrar">‚úï</button>
    <div class="nav">
      <button class="btn" id="lbPrev" aria-label="Anterior">‚Üê</button>
      <button class="btn" id="lbNext" aria-label="Siguiente">‚Üí</button>
    </div>
    <img id="lbImg" alt="" draggable="false" />
  </div>

  <script>
    /* ===== Galer√≠a robusta: ignora archivos eliminados ===== */
    (function gallery(){
      const MAX = 54;                 // m√°ximo esperado
      const EXCLUDE = new Set([2]);   // no duplicar la foto principal
      const container = document.getElementById('gallery');
      const frag = document.createDocumentFragment();

      for (let i = 1; i <= MAX; i++) {
        if (EXCLUDE.has(i)) continue;
        const img = document.createElement('img');
        const src = `img/image${i}.jpg`;
        img.setAttribute('data-src', src);
        img.alt = "";
        img.loading = 'lazy';
        img.decoding = 'async';
        img.draggable = false;

        // Carga perezosa + eliminaci√≥n si falta el archivo
        img.addEventListener('error', () => {
          // Si la imagen no existe (404), la removemos del DOM sin afectar el layout
          img.remove();
        }, { once: true });

        frag.appendChild(img);
      }
      container.appendChild(frag);

      // IntersectionObserver para asignar src real
      const io = new IntersectionObserver((entries, obs) => {
        entries.forEach(e => {
          if (!e.isIntersecting) return;
          const el = e.target, src = el.getAttribute('data-src');
          if (src) { el.src = src; el.removeAttribute('data-src'); }
          obs.unobserve(el);
        });
      }, { rootMargin: '200px 0px' });
      container.querySelectorAll('img[data-src]').forEach(img => io.observe(img));

      /* Lightbox: obtiene la lista de im√°genes v√°lidas en el momento del clic */
      const lb = document.getElementById('lightbox');
      const lbImg = document.getElementById('lbImg');
      const lbClose = document.getElementById('lbClose');
      const lbPrev = document.getElementById('lbPrev');
      const lbNext = document.getElementById('lbNext');

      let open = false, idx = 0, lastFocus = null;

      function currentImgs(){
        return Array.from(container.querySelectorAll('img[src]')); // solo las que cargaron bien
      }
      function show(i){
        const imgs = currentImgs();
        if (!imgs.length) return;
        idx = (i + imgs.length) % imgs.length;
        lbImg.src = imgs[idx].src;
      }
      function openLB(i, trigger){
        lastFocus = trigger || document.activeElement;
        show(i);
        lb.classList.add('open');
        lb.setAttribute('aria-hidden', 'false');
        lbClose.focus();
        open = true;
        document.body.style.overflow = 'hidden';
      }
      function closeLB(){
        lb.classList.remove('open');
        lb.setAttribute('aria-hidden', 'true');
        open = false;
        document.body.style.overflow = '';
        if (lastFocus) lastFocus.focus();
      }
      function next(){ show(idx + 1); }
      function prev(){ show(idx - 1); }

      container.addEventListener('click', (e) => {
        const imgs = currentImgs();
        const target = e.target.closest('img');
        if (!target) return;
        const i = imgs.indexOf(target);
        if (i >= 0) openLB(i, target);
      });

      lbClose.addEventListener('click', closeLB);
      lbNext.addEventListener('click', next);
      lbPrev.addEventListener('click', prev);
      lbImg.addEventListener('click', closeLB);

      document.addEventListener('keydown', (e) => {
        if (!open) return;
        if (e.key === 'Escape') closeLB();
        else if (e.key === 'ArrowRight') next();
        else if (e.key === 'ArrowLeft') prev();

        const focusables = [lbClose, lbPrev, lbNext];
        if (e.key === 'Tab') {
          e.preventDefault();
          const cur = document.activeElement;
          const i = (focusables.indexOf(cur) + (e.shiftKey ? -1 : 1) + focusables.length) % focusables.length;
          focusables[i].focus();
        }
      });

      // Gestos t√°ctiles
      let startX = 0, deltaX = 0;
      lb.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; deltaX = 0; }, { passive: true });
      lb.addEventListener('touchmove', (e) => { deltaX = e.touches[0].clientX - startX; }, { passive: true });
      lb.addEventListener('touchend', () => { if (Math.abs(deltaX) > 40) (deltaX < 0 ? next() : prev()); startX = 0; deltaX = 0; });
    })();

    /* ===== M√∫sica: inicia siempre en pausa (YouTube + fallback) ===== */
    (function music(){
      const VIDEO_ID = "Mv6GRNec2mc";
      const ctrl = document.getElementById('musicCtrl');
      const btnPlay = document.getElementById('btnPlay');
      const btnMute = document.getElementById('btnMute');
      const fallback = document.getElementById('bgmFallback');
      let ytReady=false, ytFailed=false, usingFallback=false, ytPlayer;

      const s = document.createElement('script');
      s.src = "https://www.youtube.com/iframe_api";
      s.onerror = () => { ytFailed=true; useFallback(); };
      document.head.appendChild(s);
      ctrl.hidden = false;

      window.onYouTubeIframeAPIReady = function(){
        try{
          ytPlayer = new YT.Player('yt-player', {
            height:'1', width:'1', videoId: VIDEO_ID,
            playerVars:{ autoplay:0, controls:0, disablekb:1, fs:0, modestbranding:1, rel:0, loop:1, playlist:VIDEO_ID, playsinline:1 },
            events:{ onReady:()=>{ ytReady=true; setupControls(); }, onError:()=>{ ytFailed=true; useFallback(); } }
          });
        }catch(e){ ytFailed=true; useFallback(); }
      };

      function useFallback(){ usingFallback=true; setupControls(); }

      function setupControls(){
        const mutedPref = localStorage.getItem('bgm:muted') === 'true';

        // Estado inicial forzado en pausa
        btnPlay.textContent = '‚ñ∂Ô∏è Reproducir';
        btnPlay.setAttribute('aria-label','Reproducir m√∫sica');
        localStorage.setItem('bgm:pref','off');

        // Aplicar mute preferido sin reproducir
        if(usingFallback){ fallback.muted = mutedPref; }
        else if(ytReady){ if(mutedPref) ytPlayer.mute(); else ytPlayer.unMute(); }
        btnMute.textContent = mutedPref ? 'üîá' : 'üîà';

        function play(){
          if(usingFallback){ fallback.play().catch(()=>{}); }
          else if(ytReady){ ytPlayer.playVideo(); }
          btnPlay.textContent = '‚è∏Ô∏è Pausar';
          btnPlay.setAttribute('aria-label','Pausar m√∫sica');
          localStorage.setItem('bgm:pref','on');
        }
        function pause(){
          if(usingFallback){ fallback.pause(); }
          else if(ytReady){ ytPlayer.pauseVideo(); }
          btnPlay.textContent = '‚ñ∂Ô∏è Reproducir';
          btnPlay.setAttribute('aria-label','Reproducir m√∫sica');
          localStorage.setItem('bgm:pref','off');
        }
        function toggleMute(){
          if(usingFallback){
            fallback.muted = !fallback.muted;
            btnMute.textContent = fallback.muted ? 'üîá' : 'üîà';
            localStorage.setItem('bgm:muted', String(fallback.muted));
          }else if(ytReady){
            if(ytPlayer.isMuted()) ytPlayer.unMute(); else ytPlayer.mute();
            btnMute.textContent = ytPlayer.isMuted() ? 'üîá' : 'üîà';
            localStorage.setItem('bgm:muted', String(ytPlayer.isMuted()));
          }
        }

        btnPlay.onclick = () => {
          if(usingFallback){ fallback.paused ? play() : pause(); }
          else if(ytReady){ const st = ytPlayer.getPlayerState(); (st !== YT.PlayerState.PLAYING) ? play() : pause(); }
          else { if(!usingFallback) useFallback(); play(); }
        };
        btnMute.onclick = toggleMute;
      }
    })();
  </script>
</body>
</html>
